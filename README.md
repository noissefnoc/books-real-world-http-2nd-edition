# books-real-world-http-2nd-edition
O'Reillyの『Real World HTTP』第二版の読書レポジトリです

## 1章 HTTP/1.0の世界：基本となる4つの要素

HTTPの仕様策定順番に沿って機能の拡張を追っていく。HTTPの基本要素としてここでは

* メソッドとパス
* ヘッダー
* ボディ
* ステータス

を取り上げる。サーバ側の実装はGo、クライアント側は`curl`コマンドを使う。

### 1.1 HTTPの歴史

* 1990年：HTTP/0.9 (実際にはHTTP/1.0以前の仕様をさす)
* 1996年：HTTP/1.0
* 1997年：HTTP/1.1
* 2015年：HTTP/2

そして正式にはまだ策定されていないものの、HTTP/3が現在策定中。

HTTP/0.9はHTMLのドキュメントを要求して取得するだけのプロトコル。その後、フォームを送信したり、情報を更新したり、チャット機能の実装に使われたり、柔軟性や高度な機能が必要とされるたびに拡張されました。

#### 1.1.1 テストエコーサーバの実行

エコーサーバーを作ってみる。Goだとこのドメインのプログラムは簡単に書ける。

### 1.2 HTTP/0.9でできることを試す

現状HTTP/1.0しか使えないので、疑似的にだが、`curl`でGetリクエストにクエリをつけて渡す。

コードは `echo/server.go` に配置。

### 1.3 HTTP/0.9から1.0への道のり

HTTP/0.9の機能制約について

* 1つのドキュメントを送る機能しかなかった
* 通信されるすべての内容はHTML文書であるという想定だったため、ダウンロードするコンテンツのフォーマットをサーバから伝える手段がなかった
* クライアント側から検索のリクエストを送る以外のリクエストを送信できなかった
* 新しい文章を送信したり、更新したり、削除することはできなかった

また、リクエストが正しかったか、もしくはサーバが正しく応答を返すことができたかといった情報を知る方法もなかった。

バージョンがついていないが1992年に0.9と1.0の中間のバージョンがあり

* リクエスト時にメソッドが追加された(GET)
* リクエスト時にHTTPバージョンが追加された(HTTP/1.0)
* ヘッダーが追加された(Host, User-Agent, Accept)

などの変更があった。

### 1.4 HTTP の先祖(1) 電子メーール

確かに電子メールもヘッダとボディの間に空行を入れる仕様だった。

#### 1.4.1 ヘッダーの送信

同じヘッダーを複数回送ることを許容している。これがgRPCのMetadataに継承されていて、単一キーでも複数の値を取れる。

#### 1.4.2 ヘッダーの受信

`curl` で verbose モードを使えばサーバヘッダも表示されるという話。

#### 1.4.3 MIMEタイプ

ファイルタイプを指定するもので、電子メール時代からあったもの。

#### 1.4.4 Content-Typeとセキュリティ

IE が Content-Type を見ずに中身を見て判断しようとしてた話。潜在的にセキュリティ問題になりそうだけど、なんでリリースされてたんだろうか。

#### 1.4.5 電子メールとの違い

HTTPのリクエストは先頭にメソッド+パスの行が追加される。HTTPのレスポンスでは先頭にステータスが追加される。

### 1.5 HTTPの先祖(2) ニュースグループ

電子メール→ニュースグループ→HTTPという参照関係

#### 1.5.1 メソッド

HTTPのメソッドはニュースグループのプロトコルであるNetwork News Transfer Protocol (NNTP) からきている。

ニュースグループの時代にはグループのリストの取得(LIST)や記事本体の取得(BODY)などがあった。HTTPだとLISTはなく、BODYがGETになっている。

この辺りが各ブラウザで標準的に使えるようになったのが JavaScript の XmlHttpRequest がサポートされるようになってから。

ボツになったメソッドは理由を読むとさもありなんという感じ。

`curl` でメソッドを指定するには `--request=` ないしは `-X` オプションを使う。

#### 1.5.2 ステータス

ステータスコードとステータスメッセージがあったが、HTTP/2からはステータスコードのみになった。

### 1.6 リダイレクト

`curl` だと `-L` を使えばよい。

#### 1.6.1 POST送信したのに「GETメソッドは受け付けられない」エラー

ファイルがないが、末尾にスラッシュが存在してないURLを受け取ってリダイレクトされているケースで発生する、が、Windows7/8.1は対応してない。

そしてこの問題はWindows8.1のサポートが切れる2023年まで続く。
